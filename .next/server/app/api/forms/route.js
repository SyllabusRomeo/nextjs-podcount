/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/forms/route";
exports.ids = ["app/api/forms/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fforms%2Froute&page=%2Fapi%2Fforms%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fforms%2Froute.ts&appDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fforms%2Froute&page=%2Fapi%2Fforms%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fforms%2Froute.ts&appDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_romeo_fredson_podcount_nextjs_podcount_src_app_api_forms_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/forms/route.ts */ \"(rsc)/./src/app/api/forms/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/forms/route\",\n        pathname: \"/api/forms\",\n        filename: \"route\",\n        bundlePath: \"app/api/forms/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\romeo.fredson\\\\podcount\\\\nextjs-podcount\\\\src\\\\app\\\\api\\\\forms\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_romeo_fredson_podcount_nextjs_podcount_src_app_api_forms_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZmb3JtcyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZm9ybXMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZmb3JtcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNyb21lby5mcmVkc29uJTVDcG9kY291bnQlNUNuZXh0anMtcG9kY291bnQlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3JvbWVvLmZyZWRzb24lNUNwb2Rjb3VudCU1Q25leHRqcy1wb2Rjb3VudCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDbUM7QUFDaEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXHJvbWVvLmZyZWRzb25cXFxccG9kY291bnRcXFxcbmV4dGpzLXBvZGNvdW50XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGZvcm1zXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9mb3Jtcy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2Zvcm1zXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9mb3Jtcy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXHJvbWVvLmZyZWRzb25cXFxccG9kY291bnRcXFxcbmV4dGpzLXBvZGNvdW50XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGZvcm1zXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fforms%2Froute&page=%2Fapi%2Fforms%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fforms%2Froute.ts&appDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/forms/route.ts":
/*!************************************!*\
  !*** ./src/app/api/forms/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n\n\nconst DEFAULT_TEMPLATES = {\n    CONVENTIONAL: {\n        name: \"Conventional Cocoa Pod Count Template\",\n        description: \"Default template for conventional cocoa pod counting exercise\",\n        type: \"CONVENTIONAL\",\n        fields: JSON.stringify([\n            {\n                name: \"farmer_id\",\n                type: \"text\",\n                label: \"Farmer ID\",\n                required: true\n            },\n            {\n                name: \"farmer_name\",\n                type: \"text\",\n                label: \"Farmer Name\",\n                required: true\n            },\n            {\n                name: \"national_id\",\n                type: \"text\",\n                label: \"National ID Number\",\n                required: true\n            },\n            {\n                name: \"phone_number\",\n                type: \"tel\",\n                label: \"Phone Number\",\n                required: true\n            },\n            {\n                name: \"operational_area\",\n                type: \"text\",\n                label: \"Operational Area\",\n                required: true\n            },\n            {\n                name: \"community\",\n                type: \"text\",\n                label: \"Community\",\n                required: true\n            },\n            {\n                name: \"small_cherelles\",\n                type: \"number\",\n                label: \"Small Cherelles (S)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"medium\",\n                type: \"number\",\n                label: \"Medium (M)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"large\",\n                type: \"number\",\n                label: \"Large (L)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"matured_unriped\",\n                type: \"number\",\n                label: \"Matured Unriped (MUR)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"matured_riped\",\n                type: \"number\",\n                label: \"Matured Riped (MR)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"diseased\",\n                type: \"number\",\n                label: \"Diseased (D)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"count_date\",\n                type: \"date\",\n                label: \"Count Date\",\n                required: true\n            }\n        ])\n    },\n    ORGANIC: {\n        name: \"Organic Cocoa Pod Count Template\",\n        description: \"Default template for organic cocoa pod counting exercise\",\n        type: \"ORGANIC\",\n        fields: JSON.stringify([\n            {\n                name: \"farmer_id\",\n                type: \"text\",\n                label: \"Farmer ID\",\n                required: true\n            },\n            {\n                name: \"farmer_name\",\n                type: \"text\",\n                label: \"Farmer Name\",\n                required: true\n            },\n            {\n                name: \"national_id\",\n                type: \"text\",\n                label: \"National ID Number\",\n                required: true\n            },\n            {\n                name: \"phone_number\",\n                type: \"tel\",\n                label: \"Phone Number\",\n                required: true\n            },\n            {\n                name: \"operational_area\",\n                type: \"text\",\n                label: \"Operational Area\",\n                required: true\n            },\n            {\n                name: \"community\",\n                type: \"text\",\n                label: \"Community\",\n                required: true\n            },\n            {\n                name: \"organic_certification_id\",\n                type: \"text\",\n                label: \"Organic Certification ID\",\n                required: true\n            },\n            {\n                name: \"small_cherelles\",\n                type: \"number\",\n                label: \"Small Cherelles (S)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"medium\",\n                type: \"number\",\n                label: \"Medium (M)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"large\",\n                type: \"number\",\n                label: \"Large (L)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"matured_unriped\",\n                type: \"number\",\n                label: \"Matured Unriped (MUR)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"matured_riped\",\n                type: \"number\",\n                label: \"Matured Riped (MR)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"diseased\",\n                type: \"number\",\n                label: \"Diseased (D)\",\n                required: true,\n                min: 0\n            },\n            {\n                name: \"count_date\",\n                type: \"date\",\n                label: \"Count Date\",\n                required: true\n            }\n        ])\n    }\n};\nasync function POST(request) {\n    try {\n        const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.auth)();\n        if (!session?.user?.id) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse('Unauthorized', {\n                status: 401\n            });\n        }\n        const json = await request.json();\n        const { name, description, type, fields, factoryId } = json;\n        // Get user's role and factory\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n            where: {\n                id: session.user.id\n            },\n            select: {\n                role: true,\n                factoryId: true\n            }\n        });\n        const isAdmin = user?.role === 'ADMIN';\n        const targetFactoryId = factoryId || user?.factoryId;\n        if (!targetFactoryId) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse('Factory ID is required', {\n                status: 400\n            });\n        }\n        try {\n            // Create the form with proper error handling\n            const form = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.form.create({\n                data: {\n                    name,\n                    description,\n                    type,\n                    fields: typeof fields === 'string' ? fields : JSON.stringify(fields),\n                    factoryId: targetFactoryId,\n                    createdById: session.user.id\n                },\n                include: {\n                    factory: {\n                        select: {\n                            name: true,\n                            type: true\n                        }\n                    },\n                    createdBy: {\n                        select: {\n                            name: true,\n                            email: true\n                        }\n                    }\n                }\n            });\n            // Create form access for the creator\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.formAccess.create({\n                data: {\n                    userId: session.user.id,\n                    formId: form.id,\n                    canView: true,\n                    canEdit: true,\n                    canDelete: isAdmin\n                }\n            });\n            // Grant access to all users in the same factory\n            const factoryUsers = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findMany({\n                where: {\n                    factoryId: targetFactoryId,\n                    id: {\n                        not: session.user.id\n                    } // Exclude creator as they already have access\n                }\n            });\n            if (factoryUsers.length > 0) {\n                await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.formAccess.createMany({\n                    data: factoryUsers.map((factoryUser)=>({\n                            userId: factoryUser.id,\n                            formId: form.id,\n                            canView: true,\n                            canEdit: factoryUser.role === 'ADMIN' || factoryUser.role === 'SUPERVISOR' || factoryUser.role === 'FIELD_OFFICER',\n                            canDelete: factoryUser.role === 'ADMIN'\n                        }))\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                id: form.id,\n                name: form.name,\n                description: form.description,\n                type: form.type,\n                fields: form.fields,\n                factoryId: form.factoryId,\n                factoryName: form.factory?.name || 'Unknown Factory',\n                factoryType: form.factory?.type || 'CONVENTIONAL',\n                createdBy: {\n                    name: form.createdBy?.name || 'System',\n                    email: form.createdBy?.email || 'system@example.com'\n                },\n                permissions: {\n                    canView: true,\n                    canEdit: true,\n                    canDelete: isAdmin\n                },\n                createdAt: form.createdAt,\n                updatedAt: form.updatedAt\n            });\n        } catch (prismaError) {\n            // Handle Prisma errors with proper status codes and error messages\n            console.error('Error creating form:', prismaError);\n            if (prismaError.code === 'P2002') {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'A form with this name already exists for this factory',\n                    code: prismaError.code,\n                    fields: prismaError.meta?.target || [\n                        'name',\n                        'factoryId'\n                    ]\n                }, {\n                    status: 409\n                });\n            } else {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Database error',\n                    code: prismaError.code\n                }, {\n                    status: 500\n                });\n            }\n        }\n    } catch (error) {\n        console.error('Error creating form:', error);\n        return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse('Internal Server Error', {\n            status: 500\n        });\n    }\n}\nasync function GET(request) {\n    try {\n        const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.auth)();\n        if (!session?.user?.id) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse('Unauthorized', {\n                status: 401\n            });\n        }\n        const { searchParams } = new URL(request.url);\n        const factoryId = searchParams.get('factoryId');\n        // Get user's factory and role\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n            where: {\n                id: session.user.id\n            },\n            select: {\n                factoryId: true,\n                role: true\n            }\n        });\n        if (!user) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse('User not found', {\n                status: 404\n            });\n        }\n        const isAdmin = user.role === 'ADMIN';\n        // First, ensure default templates exist for the factory\n        if (user.factoryId) {\n            const factory = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.factory.findUnique({\n                where: {\n                    id: user.factoryId\n                },\n                select: {\n                    type: true\n                }\n            });\n            if (factory) {\n                // Check if default template exists for this factory type\n                const defaultTemplateName = factory.type === 'ORGANIC' ? \"Organic Cocoa Pod Count Template\" : \"Conventional Cocoa Pod Count Template\";\n                const defaultTemplate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.form.findFirst({\n                    where: {\n                        factoryId: user.factoryId,\n                        name: defaultTemplateName\n                    }\n                });\n                if (!defaultTemplate) {\n                    // Create default template based on factory type\n                    const template = DEFAULT_TEMPLATES[factory.type === 'ORGANIC' ? 'ORGANIC' : 'CONVENTIONAL'];\n                    const newForm = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.form.create({\n                        data: {\n                            ...template,\n                            factoryId: user.factoryId,\n                            createdById: session.user.id\n                        }\n                    });\n                    // Create form access for all users in the factory\n                    const factoryUsers = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findMany({\n                        where: {\n                            factoryId: user.factoryId\n                        }\n                    });\n                    if (factoryUsers.length > 0) {\n                        await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.formAccess.createMany({\n                            data: factoryUsers.map((factoryUser)=>({\n                                    userId: factoryUser.id,\n                                    formId: newForm.id,\n                                    canView: true,\n                                    canEdit: factoryUser.role === 'ADMIN' || factoryUser.role === 'SUPERVISOR',\n                                    canDelete: factoryUser.role === 'ADMIN'\n                                }))\n                        });\n                    }\n                }\n            }\n        }\n        // Build the where clause based on user role and factory\n        let whereClause = {};\n        // Factory filter\n        if (factoryId) {\n            whereClause.factoryId = factoryId;\n        } else if (!isAdmin && user.factoryId) {\n            // Non-admin users can only see forms from their factory\n            whereClause.factoryId = user.factoryId;\n        }\n        // Access control filter for non-admin users\n        if (!isAdmin) {\n            whereClause.OR = [\n                {\n                    // Forms they have explicit access to\n                    access: {\n                        some: {\n                            userId: session.user.id,\n                            canView: true\n                        }\n                    }\n                },\n                {\n                    // Forms they created\n                    createdById: session.user.id\n                }\n            ];\n        }\n        // First get all forms that match our criteria\n        const forms = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.form.findMany({\n            where: whereClause,\n            include: {\n                factory: {\n                    select: {\n                        name: true,\n                        type: true\n                    }\n                },\n                createdBy: {\n                    select: {\n                        name: true,\n                        email: true\n                    }\n                },\n                access: {\n                    where: {\n                        userId: session.user.id\n                    },\n                    select: {\n                        canView: true,\n                        canEdit: true,\n                        canDelete: true\n                    }\n                }\n            },\n            orderBy: {\n                createdAt: 'desc'\n            }\n        });\n        // Map to safe response objects with permissions\n        const safeForms = await Promise.all(forms.map(async (form)=>{\n            // Get form access permissions\n            const access = form.access[0] || {\n                canView: false,\n                canEdit: false,\n                canDelete: false\n            };\n            // If user is admin or form creator, they have full access\n            const hasFullAccess = isAdmin || form.createdById === session.user.id;\n            return {\n                id: form.id,\n                name: form.name,\n                description: form.description,\n                type: form.type,\n                fields: form.fields,\n                factoryId: form.factoryId,\n                factoryName: form.factory?.name || 'Unknown Factory',\n                factoryType: form.factory?.type || 'CONVENTIONAL',\n                createdBy: {\n                    name: form.createdBy?.name || 'System',\n                    email: form.createdBy?.email || 'system@example.com'\n                },\n                permissions: {\n                    canView: hasFullAccess || access.canView,\n                    canEdit: hasFullAccess || access.canEdit,\n                    canDelete: hasFullAccess || access.canDelete\n                },\n                createdAt: form.createdAt,\n                updatedAt: form.updatedAt\n            };\n        }));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(safeForms);\n    } catch (error) {\n        console.error('Error fetching forms:', error);\n        return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse('Internal Server Error', {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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XFxzcmNcXGFwcFxcYXBpXFxmb3Jtc1xccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQC9saWIvYXV0aCc7XHJcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XHJcblxyXG5jb25zdCBERUZBVUxUX1RFTVBMQVRFUyA9IHtcclxuICBDT05WRU5USU9OQUw6IHtcclxuICAgIG5hbWU6IFwiQ29udmVudGlvbmFsIENvY29hIFBvZCBDb3VudCBUZW1wbGF0ZVwiLFxyXG4gICAgZGVzY3JpcHRpb246IFwiRGVmYXVsdCB0ZW1wbGF0ZSBmb3IgY29udmVudGlvbmFsIGNvY29hIHBvZCBjb3VudGluZyBleGVyY2lzZVwiLFxyXG4gICAgdHlwZTogXCJDT05WRU5USU9OQUxcIixcclxuICAgIGZpZWxkczogSlNPTi5zdHJpbmdpZnkoW1xyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJmYXJtZXJfaWRcIixcclxuICAgICAgICB0eXBlOiBcInRleHRcIixcclxuICAgICAgICBsYWJlbDogXCJGYXJtZXIgSURcIixcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJmYXJtZXJfbmFtZVwiLFxyXG4gICAgICAgIHR5cGU6IFwidGV4dFwiLFxyXG4gICAgICAgIGxhYmVsOiBcIkZhcm1lciBOYW1lXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwibmF0aW9uYWxfaWRcIixcclxuICAgICAgICB0eXBlOiBcInRleHRcIixcclxuICAgICAgICBsYWJlbDogXCJOYXRpb25hbCBJRCBOdW1iZXJcIixcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJwaG9uZV9udW1iZXJcIixcclxuICAgICAgICB0eXBlOiBcInRlbFwiLFxyXG4gICAgICAgIGxhYmVsOiBcIlBob25lIE51bWJlclwiLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm9wZXJhdGlvbmFsX2FyZWFcIixcclxuICAgICAgICB0eXBlOiBcInRleHRcIixcclxuICAgICAgICBsYWJlbDogXCJPcGVyYXRpb25hbCBBcmVhXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwiY29tbXVuaXR5XCIsXHJcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXHJcbiAgICAgICAgbGFiZWw6IFwiQ29tbXVuaXR5XCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwic21hbGxfY2hlcmVsbGVzXCIsXHJcbiAgICAgICAgdHlwZTogXCJudW1iZXJcIixcclxuICAgICAgICBsYWJlbDogXCJTbWFsbCBDaGVyZWxsZXMgKFMpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm1lZGl1bVwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiTWVkaXVtIChNKVwiLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgIG1pbjogMFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJsYXJnZVwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiTGFyZ2UgKEwpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm1hdHVyZWRfdW5yaXBlZFwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiTWF0dXJlZCBVbnJpcGVkIChNVVIpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm1hdHVyZWRfcmlwZWRcIixcclxuICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxyXG4gICAgICAgIGxhYmVsOiBcIk1hdHVyZWQgUmlwZWQgKE1SKVwiLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgIG1pbjogMFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJkaXNlYXNlZFwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiRGlzZWFzZWQgKEQpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcImNvdW50X2RhdGVcIixcclxuICAgICAgICB0eXBlOiBcImRhdGVcIixcclxuICAgICAgICBsYWJlbDogXCJDb3VudCBEYXRlXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgXSlcclxuICB9LFxyXG4gIE9SR0FOSUM6IHtcclxuICAgIG5hbWU6IFwiT3JnYW5pYyBDb2NvYSBQb2QgQ291bnQgVGVtcGxhdGVcIixcclxuICAgIGRlc2NyaXB0aW9uOiBcIkRlZmF1bHQgdGVtcGxhdGUgZm9yIG9yZ2FuaWMgY29jb2EgcG9kIGNvdW50aW5nIGV4ZXJjaXNlXCIsXHJcbiAgICB0eXBlOiBcIk9SR0FOSUNcIixcclxuICAgIGZpZWxkczogSlNPTi5zdHJpbmdpZnkoW1xyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJmYXJtZXJfaWRcIixcclxuICAgICAgICB0eXBlOiBcInRleHRcIixcclxuICAgICAgICBsYWJlbDogXCJGYXJtZXIgSURcIixcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJmYXJtZXJfbmFtZVwiLFxyXG4gICAgICAgIHR5cGU6IFwidGV4dFwiLFxyXG4gICAgICAgIGxhYmVsOiBcIkZhcm1lciBOYW1lXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwibmF0aW9uYWxfaWRcIixcclxuICAgICAgICB0eXBlOiBcInRleHRcIixcclxuICAgICAgICBsYWJlbDogXCJOYXRpb25hbCBJRCBOdW1iZXJcIixcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJwaG9uZV9udW1iZXJcIixcclxuICAgICAgICB0eXBlOiBcInRlbFwiLFxyXG4gICAgICAgIGxhYmVsOiBcIlBob25lIE51bWJlclwiLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm9wZXJhdGlvbmFsX2FyZWFcIixcclxuICAgICAgICB0eXBlOiBcInRleHRcIixcclxuICAgICAgICBsYWJlbDogXCJPcGVyYXRpb25hbCBBcmVhXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwiY29tbXVuaXR5XCIsXHJcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXHJcbiAgICAgICAgbGFiZWw6IFwiQ29tbXVuaXR5XCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwib3JnYW5pY19jZXJ0aWZpY2F0aW9uX2lkXCIsXHJcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXHJcbiAgICAgICAgbGFiZWw6IFwiT3JnYW5pYyBDZXJ0aWZpY2F0aW9uIElEXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwic21hbGxfY2hlcmVsbGVzXCIsXHJcbiAgICAgICAgdHlwZTogXCJudW1iZXJcIixcclxuICAgICAgICBsYWJlbDogXCJTbWFsbCBDaGVyZWxsZXMgKFMpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm1lZGl1bVwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiTWVkaXVtIChNKVwiLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgIG1pbjogMFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJsYXJnZVwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiTGFyZ2UgKEwpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm1hdHVyZWRfdW5yaXBlZFwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiTWF0dXJlZCBVbnJpcGVkIChNVVIpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcIm1hdHVyZWRfcmlwZWRcIixcclxuICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxyXG4gICAgICAgIGxhYmVsOiBcIk1hdHVyZWQgUmlwZWQgKE1SKVwiLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgIG1pbjogMFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJkaXNlYXNlZFwiLFxyXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXHJcbiAgICAgICAgbGFiZWw6IFwiRGlzZWFzZWQgKEQpXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgbWluOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiBcImNvdW50X2RhdGVcIixcclxuICAgICAgICB0eXBlOiBcImRhdGVcIixcclxuICAgICAgICBsYWJlbDogXCJDb3VudCBEYXRlXCIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgXSlcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmlkKSB7XHJcbiAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKCdVbmF1dGhvcml6ZWQnLCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcclxuICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIHR5cGUsIGZpZWxkcywgZmFjdG9yeUlkIH0gPSBqc29uO1xyXG5cclxuICAgIC8vIEdldCB1c2VyJ3Mgcm9sZSBhbmQgZmFjdG9yeVxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogc2Vzc2lvbi51c2VyLmlkIH0sXHJcbiAgICAgIHNlbGVjdDogeyBcclxuICAgICAgICByb2xlOiB0cnVlLFxyXG4gICAgICAgIGZhY3RvcnlJZDogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBpc0FkbWluID0gdXNlcj8ucm9sZSA9PT0gJ0FETUlOJztcclxuICAgIGNvbnN0IHRhcmdldEZhY3RvcnlJZCA9IGZhY3RvcnlJZCB8fCB1c2VyPy5mYWN0b3J5SWQ7XHJcblxyXG4gICAgaWYgKCF0YXJnZXRGYWN0b3J5SWQpIHtcclxuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoJ0ZhY3RvcnkgSUQgaXMgcmVxdWlyZWQnLCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENyZWF0ZSB0aGUgZm9ybSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgICBjb25zdCBmb3JtID0gYXdhaXQgcHJpc21hLmZvcm0uY3JlYXRlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgZmllbGRzOiB0eXBlb2YgZmllbGRzID09PSAnc3RyaW5nJyA/IGZpZWxkcyA6IEpTT04uc3RyaW5naWZ5KGZpZWxkcyksXHJcbiAgICAgICAgICBmYWN0b3J5SWQ6IHRhcmdldEZhY3RvcnlJZCxcclxuICAgICAgICAgIGNyZWF0ZWRCeUlkOiBzZXNzaW9uLnVzZXIuaWRcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgIGZhY3Rvcnk6IHtcclxuICAgICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgICB0eXBlOiB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjcmVhdGVkQnk6IHtcclxuICAgICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgICBlbWFpbDogdHJ1ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBmb3JtIGFjY2VzcyBmb3IgdGhlIGNyZWF0b3JcclxuICAgICAgYXdhaXQgcHJpc21hLmZvcm1BY2Nlc3MuY3JlYXRlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcclxuICAgICAgICAgIGZvcm1JZDogZm9ybS5pZCxcclxuICAgICAgICAgIGNhblZpZXc6IHRydWUsXHJcbiAgICAgICAgICBjYW5FZGl0OiB0cnVlLFxyXG4gICAgICAgICAgY2FuRGVsZXRlOiBpc0FkbWluXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEdyYW50IGFjY2VzcyB0byBhbGwgdXNlcnMgaW4gdGhlIHNhbWUgZmFjdG9yeVxyXG4gICAgICBjb25zdCBmYWN0b3J5VXNlcnMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XHJcbiAgICAgICAgd2hlcmU6IHsgXHJcbiAgICAgICAgICBmYWN0b3J5SWQ6IHRhcmdldEZhY3RvcnlJZCxcclxuICAgICAgICAgIGlkOiB7IG5vdDogc2Vzc2lvbi51c2VyLmlkIH0gLy8gRXhjbHVkZSBjcmVhdG9yIGFzIHRoZXkgYWxyZWFkeSBoYXZlIGFjY2Vzc1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZmFjdG9yeVVzZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhd2FpdCBwcmlzbWEuZm9ybUFjY2Vzcy5jcmVhdGVNYW55KHtcclxuICAgICAgICAgIGRhdGE6IGZhY3RvcnlVc2Vycy5tYXAoZmFjdG9yeVVzZXIgPT4gKHtcclxuICAgICAgICAgICAgdXNlcklkOiBmYWN0b3J5VXNlci5pZCxcclxuICAgICAgICAgICAgZm9ybUlkOiBmb3JtLmlkLFxyXG4gICAgICAgICAgICBjYW5WaWV3OiB0cnVlLFxyXG4gICAgICAgICAgICBjYW5FZGl0OiBmYWN0b3J5VXNlci5yb2xlID09PSAnQURNSU4nIHx8IGZhY3RvcnlVc2VyLnJvbGUgPT09ICdTVVBFUlZJU09SJyB8fCBmYWN0b3J5VXNlci5yb2xlID09PSAnRklFTERfT0ZGSUNFUicsXHJcbiAgICAgICAgICAgIGNhbkRlbGV0ZTogZmFjdG9yeVVzZXIucm9sZSA9PT0gJ0FETUlOJ1xyXG4gICAgICAgICAgfSkpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgaWQ6IGZvcm0uaWQsXHJcbiAgICAgICAgbmFtZTogZm9ybS5uYW1lLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBmb3JtLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgIHR5cGU6IGZvcm0udHlwZSxcclxuICAgICAgICBmaWVsZHM6IGZvcm0uZmllbGRzLFxyXG4gICAgICAgIGZhY3RvcnlJZDogZm9ybS5mYWN0b3J5SWQsXHJcbiAgICAgICAgZmFjdG9yeU5hbWU6IGZvcm0uZmFjdG9yeT8ubmFtZSB8fCAnVW5rbm93biBGYWN0b3J5JyxcclxuICAgICAgICBmYWN0b3J5VHlwZTogZm9ybS5mYWN0b3J5Py50eXBlIHx8ICdDT05WRU5USU9OQUwnLFxyXG4gICAgICAgIGNyZWF0ZWRCeToge1xyXG4gICAgICAgICAgbmFtZTogZm9ybS5jcmVhdGVkQnk/Lm5hbWUgfHwgJ1N5c3RlbScsXHJcbiAgICAgICAgICBlbWFpbDogZm9ybS5jcmVhdGVkQnk/LmVtYWlsIHx8ICdzeXN0ZW1AZXhhbXBsZS5jb20nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwZXJtaXNzaW9uczoge1xyXG4gICAgICAgICAgY2FuVmlldzogdHJ1ZSxcclxuICAgICAgICAgIGNhbkVkaXQ6IHRydWUsXHJcbiAgICAgICAgICBjYW5EZWxldGU6IGlzQWRtaW5cclxuICAgICAgICB9LFxyXG4gICAgICAgIGNyZWF0ZWRBdDogZm9ybS5jcmVhdGVkQXQsXHJcbiAgICAgICAgdXBkYXRlZEF0OiBmb3JtLnVwZGF0ZWRBdFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKHByaXNtYUVycm9yOiBhbnkpIHtcclxuICAgICAgLy8gSGFuZGxlIFByaXNtYSBlcnJvcnMgd2l0aCBwcm9wZXIgc3RhdHVzIGNvZGVzIGFuZCBlcnJvciBtZXNzYWdlc1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBmb3JtOicsIHByaXNtYUVycm9yKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChwcmlzbWFFcnJvci5jb2RlID09PSAnUDIwMDInKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBcclxuICAgICAgICAgICAgZXJyb3I6ICdBIGZvcm0gd2l0aCB0aGlzIG5hbWUgYWxyZWFkeSBleGlzdHMgZm9yIHRoaXMgZmFjdG9yeScsIFxyXG4gICAgICAgICAgICBjb2RlOiBwcmlzbWFFcnJvci5jb2RlLFxyXG4gICAgICAgICAgICBmaWVsZHM6IHByaXNtYUVycm9yLm1ldGE/LnRhcmdldCB8fCBbJ25hbWUnLCAnZmFjdG9yeUlkJ11cclxuICAgICAgICAgIH0sIFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwOSB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiAnRGF0YWJhc2UgZXJyb3InLCBjb2RlOiBwcmlzbWFFcnJvci5jb2RlIH0sIFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBmb3JtOicsIGVycm9yKTtcclxuICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKCdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmlkKSB7XHJcbiAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKCdVbmF1dGhvcml6ZWQnLCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICAgIGNvbnN0IGZhY3RvcnlJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ2ZhY3RvcnlJZCcpO1xyXG5cclxuICAgIC8vIEdldCB1c2VyJ3MgZmFjdG9yeSBhbmQgcm9sZVxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogc2Vzc2lvbi51c2VyLmlkIH0sXHJcbiAgICAgIHNlbGVjdDogeyBcclxuICAgICAgICBmYWN0b3J5SWQ6IHRydWUsXHJcbiAgICAgICAgcm9sZTogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoJ1VzZXIgbm90IGZvdW5kJywgeyBzdGF0dXM6IDQwNCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpc0FkbWluID0gdXNlci5yb2xlID09PSAnQURNSU4nO1xyXG5cclxuICAgIC8vIEZpcnN0LCBlbnN1cmUgZGVmYXVsdCB0ZW1wbGF0ZXMgZXhpc3QgZm9yIHRoZSBmYWN0b3J5XHJcbiAgICBpZiAodXNlci5mYWN0b3J5SWQpIHtcclxuICAgICAgY29uc3QgZmFjdG9yeSA9IGF3YWl0IHByaXNtYS5mYWN0b3J5LmZpbmRVbmlxdWUoe1xyXG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyLmZhY3RvcnlJZCB9LFxyXG4gICAgICAgIHNlbGVjdDogeyB0eXBlOiB0cnVlIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZmFjdG9yeSkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIGRlZmF1bHQgdGVtcGxhdGUgZXhpc3RzIGZvciB0aGlzIGZhY3RvcnkgdHlwZVxyXG4gICAgICAgIGNvbnN0IGRlZmF1bHRUZW1wbGF0ZU5hbWUgPSBmYWN0b3J5LnR5cGUgPT09ICdPUkdBTklDJyBcclxuICAgICAgICAgID8gXCJPcmdhbmljIENvY29hIFBvZCBDb3VudCBUZW1wbGF0ZVwiXHJcbiAgICAgICAgICA6IFwiQ29udmVudGlvbmFsIENvY29hIFBvZCBDb3VudCBUZW1wbGF0ZVwiO1xyXG5cclxuICAgICAgICBjb25zdCBkZWZhdWx0VGVtcGxhdGUgPSBhd2FpdCBwcmlzbWEuZm9ybS5maW5kRmlyc3Qoe1xyXG4gICAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgICAgZmFjdG9yeUlkOiB1c2VyLmZhY3RvcnlJZCxcclxuICAgICAgICAgICAgbmFtZTogZGVmYXVsdFRlbXBsYXRlTmFtZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIWRlZmF1bHRUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgdGVtcGxhdGUgYmFzZWQgb24gZmFjdG9yeSB0eXBlXHJcbiAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IERFRkFVTFRfVEVNUExBVEVTW2ZhY3RvcnkudHlwZSA9PT0gJ09SR0FOSUMnID8gJ09SR0FOSUMnIDogJ0NPTlZFTlRJT05BTCddO1xyXG4gICAgICAgICAgY29uc3QgbmV3Rm9ybSA9IGF3YWl0IHByaXNtYS5mb3JtLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAuLi50ZW1wbGF0ZSxcclxuICAgICAgICAgICAgICBmYWN0b3J5SWQ6IHVzZXIuZmFjdG9yeUlkLFxyXG4gICAgICAgICAgICAgIGNyZWF0ZWRCeUlkOiBzZXNzaW9uLnVzZXIuaWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgLy8gQ3JlYXRlIGZvcm0gYWNjZXNzIGZvciBhbGwgdXNlcnMgaW4gdGhlIGZhY3RvcnlcclxuICAgICAgICAgIGNvbnN0IGZhY3RvcnlVc2VycyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcclxuICAgICAgICAgICAgd2hlcmU6IHsgZmFjdG9yeUlkOiB1c2VyLmZhY3RvcnlJZCB9XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBpZiAoZmFjdG9yeVVzZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgYXdhaXQgcHJpc21hLmZvcm1BY2Nlc3MuY3JlYXRlTWFueSh7XHJcbiAgICAgICAgICAgICAgZGF0YTogZmFjdG9yeVVzZXJzLm1hcChmYWN0b3J5VXNlciA9PiAoe1xyXG4gICAgICAgICAgICAgICAgdXNlcklkOiBmYWN0b3J5VXNlci5pZCxcclxuICAgICAgICAgICAgICAgIGZvcm1JZDogbmV3Rm9ybS5pZCxcclxuICAgICAgICAgICAgICAgIGNhblZpZXc6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBjYW5FZGl0OiBmYWN0b3J5VXNlci5yb2xlID09PSAnQURNSU4nIHx8IGZhY3RvcnlVc2VyLnJvbGUgPT09ICdTVVBFUlZJU09SJyxcclxuICAgICAgICAgICAgICAgIGNhbkRlbGV0ZTogZmFjdG9yeVVzZXIucm9sZSA9PT0gJ0FETUlOJ1xyXG4gICAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBCdWlsZCB0aGUgd2hlcmUgY2xhdXNlIGJhc2VkIG9uIHVzZXIgcm9sZSBhbmQgZmFjdG9yeVxyXG4gICAgbGV0IHdoZXJlQ2xhdXNlOiBhbnkgPSB7fTtcclxuICAgIFxyXG4gICAgLy8gRmFjdG9yeSBmaWx0ZXJcclxuICAgIGlmIChmYWN0b3J5SWQpIHtcclxuICAgICAgd2hlcmVDbGF1c2UuZmFjdG9yeUlkID0gZmFjdG9yeUlkO1xyXG4gICAgfSBlbHNlIGlmICghaXNBZG1pbiAmJiB1c2VyLmZhY3RvcnlJZCkge1xyXG4gICAgICAvLyBOb24tYWRtaW4gdXNlcnMgY2FuIG9ubHkgc2VlIGZvcm1zIGZyb20gdGhlaXIgZmFjdG9yeVxyXG4gICAgICB3aGVyZUNsYXVzZS5mYWN0b3J5SWQgPSB1c2VyLmZhY3RvcnlJZDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBY2Nlc3MgY29udHJvbCBmaWx0ZXIgZm9yIG5vbi1hZG1pbiB1c2Vyc1xyXG4gICAgaWYgKCFpc0FkbWluKSB7XHJcbiAgICAgIHdoZXJlQ2xhdXNlLk9SID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIC8vIEZvcm1zIHRoZXkgaGF2ZSBleHBsaWNpdCBhY2Nlc3MgdG9cclxuICAgICAgICAgIGFjY2Vzczoge1xyXG4gICAgICAgICAgICBzb21lOiB7XHJcbiAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXHJcbiAgICAgICAgICAgICAgY2FuVmlldzogdHJ1ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAvLyBGb3JtcyB0aGV5IGNyZWF0ZWRcclxuICAgICAgICAgIGNyZWF0ZWRCeUlkOiBzZXNzaW9uLnVzZXIuaWRcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmlyc3QgZ2V0IGFsbCBmb3JtcyB0aGF0IG1hdGNoIG91ciBjcml0ZXJpYVxyXG4gICAgY29uc3QgZm9ybXMgPSBhd2FpdCBwcmlzbWEuZm9ybS5maW5kTWFueSh7XHJcbiAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIGZhY3Rvcnk6IHtcclxuICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICB0eXBlOiB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjcmVhdGVkQnk6IHtcclxuICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWNjZXNzOiB7XHJcbiAgICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICBjYW5WaWV3OiB0cnVlLFxyXG4gICAgICAgICAgICBjYW5FZGl0OiB0cnVlLFxyXG4gICAgICAgICAgICBjYW5EZWxldGU6IHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIG9yZGVyQnk6IHtcclxuICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBNYXAgdG8gc2FmZSByZXNwb25zZSBvYmplY3RzIHdpdGggcGVybWlzc2lvbnNcclxuICAgIGNvbnN0IHNhZmVGb3JtcyA9IGF3YWl0IFByb21pc2UuYWxsKGZvcm1zLm1hcChhc3luYyBmb3JtID0+IHtcclxuICAgICAgLy8gR2V0IGZvcm0gYWNjZXNzIHBlcm1pc3Npb25zXHJcbiAgICAgIGNvbnN0IGFjY2VzcyA9IGZvcm0uYWNjZXNzWzBdIHx8IHsgY2FuVmlldzogZmFsc2UsIGNhbkVkaXQ6IGZhbHNlLCBjYW5EZWxldGU6IGZhbHNlIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJZiB1c2VyIGlzIGFkbWluIG9yIGZvcm0gY3JlYXRvciwgdGhleSBoYXZlIGZ1bGwgYWNjZXNzXHJcbiAgICAgIGNvbnN0IGhhc0Z1bGxBY2Nlc3MgPSBpc0FkbWluIHx8IGZvcm0uY3JlYXRlZEJ5SWQgPT09IHNlc3Npb24udXNlci5pZDtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaWQ6IGZvcm0uaWQsXHJcbiAgICAgICAgbmFtZTogZm9ybS5uYW1lLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBmb3JtLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgIHR5cGU6IGZvcm0udHlwZSxcclxuICAgICAgICBmaWVsZHM6IGZvcm0uZmllbGRzLFxyXG4gICAgICAgIGZhY3RvcnlJZDogZm9ybS5mYWN0b3J5SWQsXHJcbiAgICAgICAgZmFjdG9yeU5hbWU6IGZvcm0uZmFjdG9yeT8ubmFtZSB8fCAnVW5rbm93biBGYWN0b3J5JyxcclxuICAgICAgICBmYWN0b3J5VHlwZTogZm9ybS5mYWN0b3J5Py50eXBlIHx8ICdDT05WRU5USU9OQUwnLFxyXG4gICAgICAgIGNyZWF0ZWRCeToge1xyXG4gICAgICAgICAgbmFtZTogZm9ybS5jcmVhdGVkQnk/Lm5hbWUgfHwgJ1N5c3RlbScsXHJcbiAgICAgICAgICBlbWFpbDogZm9ybS5jcmVhdGVkQnk/LmVtYWlsIHx8ICdzeXN0ZW1AZXhhbXBsZS5jb20nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwZXJtaXNzaW9uczoge1xyXG4gICAgICAgICAgY2FuVmlldzogaGFzRnVsbEFjY2VzcyB8fCBhY2Nlc3MuY2FuVmlldyxcclxuICAgICAgICAgIGNhbkVkaXQ6IGhhc0Z1bGxBY2Nlc3MgfHwgYWNjZXNzLmNhbkVkaXQsXHJcbiAgICAgICAgICBjYW5EZWxldGU6IGhhc0Z1bGxBY2Nlc3MgfHwgYWNjZXNzLmNhbkRlbGV0ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY3JlYXRlZEF0OiBmb3JtLmNyZWF0ZWRBdCxcclxuICAgICAgICB1cGRhdGVkQXQ6IGZvcm0udXBkYXRlZEF0XHJcbiAgICAgIH07XHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHNhZmVGb3Jtcyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZvcm1zOicsIGVycm9yKTtcclxuICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKCdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiYXV0aCIsInByaXNtYSIsIkRFRkFVTFRfVEVNUExBVEVTIiwiQ09OVkVOVElPTkFMIiwibmFtZSIsImRlc2NyaXB0aW9uIiwidHlwZSIsImZpZWxkcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJsYWJlbCIsInJlcXVpcmVkIiwibWluIiwiT1JHQU5JQyIsIlBPU1QiLCJyZXF1ZXN0Iiwic2Vzc2lvbiIsInVzZXIiLCJpZCIsInN0YXR1cyIsImpzb24iLCJmYWN0b3J5SWQiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJzZWxlY3QiLCJyb2xlIiwiaXNBZG1pbiIsInRhcmdldEZhY3RvcnlJZCIsImZvcm0iLCJjcmVhdGUiLCJkYXRhIiwiY3JlYXRlZEJ5SWQiLCJpbmNsdWRlIiwiZmFjdG9yeSIsImNyZWF0ZWRCeSIsImVtYWlsIiwiZm9ybUFjY2VzcyIsInVzZXJJZCIsImZvcm1JZCIsImNhblZpZXciLCJjYW5FZGl0IiwiY2FuRGVsZXRlIiwiZmFjdG9yeVVzZXJzIiwiZmluZE1hbnkiLCJub3QiLCJsZW5ndGgiLCJjcmVhdGVNYW55IiwibWFwIiwiZmFjdG9yeVVzZXIiLCJmYWN0b3J5TmFtZSIsImZhY3RvcnlUeXBlIiwicGVybWlzc2lvbnMiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJwcmlzbWFFcnJvciIsImNvbnNvbGUiLCJlcnJvciIsImNvZGUiLCJtZXRhIiwidGFyZ2V0IiwiR0VUIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwiZ2V0IiwiZGVmYXVsdFRlbXBsYXRlTmFtZSIsImRlZmF1bHRUZW1wbGF0ZSIsImZpbmRGaXJzdCIsInRlbXBsYXRlIiwibmV3Rm9ybSIsIndoZXJlQ2xhdXNlIiwiT1IiLCJhY2Nlc3MiLCJzb21lIiwiZm9ybXMiLCJvcmRlckJ5Iiwic2FmZUZvcm1zIiwiUHJvbWlzZSIsImFsbCIsImhhc0Z1bGxBY2Nlc3MiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/forms/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   authConfig: () => (/* binding */ authConfig),\n/* harmony export */   getServerAuthSession: () => (/* binding */ getServerAuthSession),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signOut: () => (/* binding */ signOut)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n\n\n\n\nconst authConfig = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials, request) {\n                try {\n                    if (!credentials?.email || !credentials?.password) {\n                        throw new Error(\"Missing credentials\");\n                    }\n                    const user = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n                        where: {\n                            email: credentials.email\n                        },\n                        include: {\n                            factory: {\n                                select: {\n                                    name: true\n                                }\n                            }\n                        }\n                    });\n                    if (!user) {\n                        throw new Error(\"User not found\");\n                    }\n                    // Check if the user is disabled\n                    if (user.status === \"DISABLED\") {\n                        throw new Error(\"Your account has been disabled. Please contact an administrator.\");\n                    }\n                    const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compare(credentials.password, user.password);\n                    if (!isPasswordValid) {\n                        throw new Error(\"Invalid password\");\n                    }\n                    return {\n                        id: user.id,\n                        email: user.email,\n                        name: user.name,\n                        role: user.role,\n                        factoryId: user.factoryId,\n                        factoryName: user.factory?.name || null,\n                        fieldType: user.fieldType,\n                        status: user.status\n                    };\n                } catch (error) {\n                    console.error(\"Auth error:\", error);\n                    return null;\n                }\n            }\n        })\n    ],\n    pages: {\n        signIn: \"/login\",\n        error: \"/auth/error\",\n        signOut: \"/auth/signout\"\n    },\n    callbacks: {\n        authorized ({ auth, request: { nextUrl } }) {\n            const isLoggedIn = !!auth?.user;\n            const isOnLoginPage = nextUrl.pathname.startsWith('/login');\n            if (isOnLoginPage) {\n                if (isLoggedIn) return Response.redirect(new URL('/', nextUrl));\n                return true;\n            }\n            if (!isLoggedIn) {\n                return false; // Redirect to login page\n            }\n            return true;\n        },\n        async jwt ({ token, user }) {\n            if (user) {\n                return {\n                    ...token,\n                    id: user.id,\n                    role: user.role,\n                    factoryId: user.factoryId,\n                    factoryName: user.factoryName,\n                    fieldType: user.fieldType,\n                    status: user.status\n                };\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            return {\n                ...session,\n                user: {\n                    ...session.user,\n                    id: token.id,\n                    role: token.role,\n                    factoryId: token.factoryId,\n                    factoryName: token.factoryName,\n                    fieldType: token.fieldType,\n                    status: token.status\n                }\n            };\n        }\n    },\n    session: {\n        strategy: \"jwt\",\n        maxAge: 8 * 60 * 60\n    },\n    jwt: {\n        maxAge: 8 * 60 * 60\n    },\n    secret: process.env.NEXTAUTH_SECRET,\n    debug: \"development\" === 'development'\n};\n// Export the handlers\nconst { handlers: { GET, POST }, auth, signIn, signOut } = (0,next_auth__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(authConfig);\n// Export a method to get the session\nconst getServerAuthSession = async (context)=>{\n    // @ts-ignore - Context typing issue with NextAuth\n    return await auth(context);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPO2dCQUNWaEMsTUFBTTtvQkFDSixHQUFHZ0MsUUFBUWhDLElBQUk7b0JBQ2ZTLElBQUlzQixNQUFNdEIsRUFBRTtvQkFDWkMsTUFBTXFCLE1BQU1yQixJQUFJO29CQUNoQkMsV0FBV29CLE1BQU1wQixTQUFTO29CQUMxQkMsYUFBYW1CLE1BQU1uQixXQUFXO29CQUM5QkMsV0FBV2tCLE1BQU1sQixTQUFTO29CQUMxQlAsUUFBUXlCLE1BQU16QixNQUFNO2dCQUN0QjtZQUNGO1FBQ0Y7SUFDRjtJQUNBMEIsU0FBUztRQUNQQyxVQUFVO1FBQ1ZDLFFBQVEsSUFBSSxLQUFLO0lBQ25CO0lBQ0FKLEtBQUs7UUFDSEksUUFBUSxJQUFJLEtBQUs7SUFDbkI7SUFDQUMsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxlQUFlO0lBQ25DQyxPQUFPSCxrQkFBeUI7QUFDbEMsRUFBMkI7QUFFM0Isc0JBQXNCO0FBQ2YsTUFBTSxFQUNYSSxVQUFVLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxFQUFFLEVBQ3ZCckIsSUFBSSxFQUNKSixNQUFNLEVBQ05DLE9BQU8sRUFDUixHQUFHOUIscURBQVFBLENBQUNDLFlBQVk7QUFFekIscUNBQXFDO0FBQzlCLE1BQU1zRCx1QkFBdUIsT0FBT0M7SUFJekMsa0RBQWtEO0lBQ2xELE9BQU8sTUFBTXZCLEtBQUt1QjtBQUNwQixFQUFFIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXHJvbWVvLmZyZWRzb25cXHBvZGNvdW50XFxuZXh0anMtcG9kY291bnRcXHNyY1xcbGliXFxhdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEF1dGhDb25maWcgfSBmcm9tIFwibmV4dC1hdXRoXCI7XHJcbmltcG9ydCBDcmVkZW50aWFsc1Byb3ZpZGVyIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzXCI7XHJcbmltcG9ydCBiY3J5cHQgZnJvbSBcImJjcnlwdGpzXCI7XHJcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gXCIuL3ByaXNtYVwiO1xyXG5pbXBvcnQgTmV4dEF1dGggZnJvbSBcIm5leHQtYXV0aFwiO1xyXG5pbXBvcnQgeyBHZXRTZXJ2ZXJTaWRlUHJvcHNDb250ZXh0LCBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcclxuaW1wb3J0IHsgVXNlciB9IGZyb20gXCJuZXh0LWF1dGhcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBhdXRoQ29uZmlnID0ge1xyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XHJcbiAgICAgIG5hbWU6IFwiY3JlZGVudGlhbHNcIixcclxuICAgICAgY3JlZGVudGlhbHM6IHtcclxuICAgICAgICBlbWFpbDogeyBsYWJlbDogXCJFbWFpbFwiLCB0eXBlOiBcImVtYWlsXCIgfSxcclxuICAgICAgICBwYXNzd29yZDogeyBsYWJlbDogXCJQYXNzd29yZFwiLCB0eXBlOiBcInBhc3N3b3JkXCIgfVxyXG4gICAgICB9LFxyXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMsIHJlcXVlc3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIWNyZWRlbnRpYWxzPy5wYXNzd29yZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGNyZWRlbnRpYWxzXCIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcclxuICAgICAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgICAgICBlbWFpbDogY3JlZGVudGlhbHMuZW1haWwgYXMgc3RyaW5nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgICBmYWN0b3J5OiB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGRpc2FibGVkXHJcbiAgICAgICAgICBpZiAodXNlci5zdGF0dXMgPT09IFwiRElTQUJMRURcIikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3VyIGFjY291bnQgaGFzIGJlZW4gZGlzYWJsZWQuIFBsZWFzZSBjb250YWN0IGFuIGFkbWluaXN0cmF0b3IuXCIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKFxyXG4gICAgICAgICAgICBjcmVkZW50aWFscy5wYXNzd29yZCBhcyBzdHJpbmcsXHJcbiAgICAgICAgICAgIHVzZXIucGFzc3dvcmRcclxuICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXNzd29yZFwiKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpZDogdXNlci5pZCxcclxuICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgICAgICAgIG5hbWU6IHVzZXIubmFtZSxcclxuICAgICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxyXG4gICAgICAgICAgICBmYWN0b3J5SWQ6IHVzZXIuZmFjdG9yeUlkLFxyXG4gICAgICAgICAgICBmYWN0b3J5TmFtZTogdXNlci5mYWN0b3J5Py5uYW1lIHx8IG51bGwsXHJcbiAgICAgICAgICAgIGZpZWxkVHlwZTogdXNlci5maWVsZFR5cGUsXHJcbiAgICAgICAgICAgIHN0YXR1czogdXNlci5zdGF0dXNcclxuICAgICAgICAgIH0gYXMgVXNlcjtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkF1dGggZXJyb3I6XCIsIGVycm9yKTtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICBdLFxyXG4gIHBhZ2VzOiB7XHJcbiAgICBzaWduSW46IFwiL2xvZ2luXCIsXHJcbiAgICBlcnJvcjogXCIvYXV0aC9lcnJvclwiLFxyXG4gICAgc2lnbk91dDogXCIvYXV0aC9zaWdub3V0XCJcclxuICB9LFxyXG4gIGNhbGxiYWNrczoge1xyXG4gICAgYXV0aG9yaXplZCh7IGF1dGgsIHJlcXVlc3Q6IHsgbmV4dFVybCB9IH0pIHtcclxuICAgICAgY29uc3QgaXNMb2dnZWRJbiA9ICEhYXV0aD8udXNlcjtcclxuICAgICAgY29uc3QgaXNPbkxvZ2luUGFnZSA9IG5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL2xvZ2luJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoaXNPbkxvZ2luUGFnZSkge1xyXG4gICAgICAgIGlmIChpc0xvZ2dlZEluKSByZXR1cm4gUmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnLycsIG5leHRVcmwpKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFpc0xvZ2dlZEluKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBSZWRpcmVjdCB0byBsb2dpbiBwYWdlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyIH0pIHtcclxuICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgLi4udG9rZW4sXHJcbiAgICAgICAgICBpZDogdXNlci5pZCBhcyBzdHJpbmcsXHJcbiAgICAgICAgICByb2xlOiB1c2VyLnJvbGUsXHJcbiAgICAgICAgICBmYWN0b3J5SWQ6IHVzZXIuZmFjdG9yeUlkLFxyXG4gICAgICAgICAgZmFjdG9yeU5hbWU6IHVzZXIuZmFjdG9yeU5hbWUsXHJcbiAgICAgICAgICBmaWVsZFR5cGU6IHVzZXIuZmllbGRUeXBlLFxyXG4gICAgICAgICAgc3RhdHVzOiB1c2VyLnN0YXR1cyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0b2tlbjtcclxuICAgIH0sXHJcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLnNlc3Npb24sXHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgLi4uc2Vzc2lvbi51c2VyLFxyXG4gICAgICAgICAgaWQ6IHRva2VuLmlkLFxyXG4gICAgICAgICAgcm9sZTogdG9rZW4ucm9sZSxcclxuICAgICAgICAgIGZhY3RvcnlJZDogdG9rZW4uZmFjdG9yeUlkLFxyXG4gICAgICAgICAgZmFjdG9yeU5hbWU6IHRva2VuLmZhY3RvcnlOYW1lLFxyXG4gICAgICAgICAgZmllbGRUeXBlOiB0b2tlbi5maWVsZFR5cGUsXHJcbiAgICAgICAgICBzdGF0dXM6IHRva2VuLnN0YXR1cyxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgc2Vzc2lvbjoge1xyXG4gICAgc3RyYXRlZ3k6IFwiand0XCIsXHJcbiAgICBtYXhBZ2U6IDggKiA2MCAqIDYwLCAvLyA4IGhvdXJzXHJcbiAgfSxcclxuICBqd3Q6IHtcclxuICAgIG1heEFnZTogOCAqIDYwICogNjAsIC8vIDggaG91cnNcclxuICB9LFxyXG4gIHNlY3JldDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVULFxyXG4gIGRlYnVnOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyxcclxufSBzYXRpc2ZpZXMgTmV4dEF1dGhDb25maWc7XHJcblxyXG4vLyBFeHBvcnQgdGhlIGhhbmRsZXJzXHJcbmV4cG9ydCBjb25zdCB7XHJcbiAgaGFuZGxlcnM6IHsgR0VULCBQT1NUIH0sXHJcbiAgYXV0aCxcclxuICBzaWduSW4sXHJcbiAgc2lnbk91dCxcclxufSA9IE5leHRBdXRoKGF1dGhDb25maWcpO1xyXG5cclxuLy8gRXhwb3J0IGEgbWV0aG9kIHRvIGdldCB0aGUgc2Vzc2lvblxyXG5leHBvcnQgY29uc3QgZ2V0U2VydmVyQXV0aFNlc3Npb24gPSBhc3luYyAoY29udGV4dDoge1xyXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QgfCBSZXF1ZXN0O1xyXG4gIHJlcz86IE5leHRBcGlSZXNwb25zZTtcclxufSkgPT4ge1xyXG4gIC8vIEB0cy1pZ25vcmUgLSBDb250ZXh0IHR5cGluZyBpc3N1ZSB3aXRoIE5leHRBdXRoXHJcbiAgcmV0dXJuIGF3YWl0IGF1dGgoY29udGV4dCk7XHJcbn07ICJdLCJuYW1lcyI6WyJDcmVkZW50aWFsc1Byb3ZpZGVyIiwiYmNyeXB0IiwicHJpc21hIiwiTmV4dEF1dGgiLCJhdXRoQ29uZmlnIiwicHJvdmlkZXJzIiwibmFtZSIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJsYWJlbCIsInR5cGUiLCJwYXNzd29yZCIsImF1dGhvcml6ZSIsInJlcXVlc3QiLCJFcnJvciIsInVzZXIiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJpbmNsdWRlIiwiZmFjdG9yeSIsInNlbGVjdCIsInN0YXR1cyIsImlzUGFzc3dvcmRWYWxpZCIsImNvbXBhcmUiLCJpZCIsInJvbGUiLCJmYWN0b3J5SWQiLCJmYWN0b3J5TmFtZSIsImZpZWxkVHlwZSIsImVycm9yIiwiY29uc29sZSIsInBhZ2VzIiwic2lnbkluIiwic2lnbk91dCIsImNhbGxiYWNrcyIsImF1dGhvcml6ZWQiLCJhdXRoIiwibmV4dFVybCIsImlzTG9nZ2VkSW4iLCJpc09uTG9naW5QYWdlIiwicGF0aG5hbWUiLCJzdGFydHNXaXRoIiwiUmVzcG9uc2UiLCJyZWRpcmVjdCIsIlVSTCIsImp3dCIsInRva2VuIiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwibWF4QWdlIiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIk5FWFRBVVRIX1NFQ1JFVCIsImRlYnVnIiwiaGFuZGxlcnMiLCJHRVQiLCJQT1NUIiwiZ2V0U2VydmVyQXV0aFNlc3Npb24iLCJjb250ZXh0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) {\n    global.prisma = prisma;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFNdkMsTUFBTUMsU0FBU0MsT0FBT0QsTUFBTSxJQUFJLElBQUlELHdEQUFZQSxHQUFHO0FBRTFELElBQUlHLElBQXFDLEVBQUU7SUFDekNELE9BQU9ELE1BQU0sR0FBR0E7QUFDbEIiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xccm9tZW8uZnJlZHNvblxccG9kY291bnRcXG5leHRqcy1wb2Rjb3VudFxcc3JjXFxsaWJcXHByaXNtYS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XHJcblxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgdmFyIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcHJpc21hID0gZ2xvYmFsLnByaXNtYSB8fCBuZXcgUHJpc21hQ2xpZW50KCk7XHJcblxyXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gIGdsb2JhbC5wcmlzbWEgPSBwcmlzbWE7XHJcbn0gIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsInByaXNtYSIsImdsb2JhbCIsInByb2Nlc3MiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:buffer":
/*!******************************!*\
  !*** external "node:buffer" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:buffer");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/oauth4webapi","vendor-chunks/bcryptjs","vendor-chunks/cookie","vendor-chunks/@panva"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fforms%2Froute&page=%2Fapi%2Fforms%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fforms%2Froute.ts&appDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cromeo.fredson%5Cpodcount%5Cnextjs-podcount&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();